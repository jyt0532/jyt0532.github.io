<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大家的日本語 第27課 - 互動單字卡</title>
    
    <!-- 1. 載入 Tailwind CSS (樣式) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. 載入 Babel (讓瀏覽器看得懂 JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. 設定 Import Map (告訴瀏覽器去哪裡抓 React 和套件) -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.294.0"
        }
    }
    </script>

    <style>
        /* 翻牌動畫所需的額外 CSS */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        ruby { ruby-align: center; }
        rt { line-height: 1; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <!-- 4. React 應用程式邏輯 -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { ChevronLeft, ChevronRight, RotateCcw, Volume2, BookOpen, Lightbulb } from 'lucide-react';

        const VocabularySlides = () => {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [loading, setLoading] = useState(true);

            // Furigana Component
            const FuriganaText = ({ text, className = "" }) => {
                if (!text) return null;
                const regex = /([\u4e00-\u9faf々]+)\[(.*?)\]/g;
                const parts = [];
                let lastIndex = 0;
                let match;

                while ((match = regex.exec(text)) !== null) {
                    if (match.index > lastIndex) {
                        parts.push(<span key={lastIndex}>{text.substring(lastIndex, match.index)}</span>);
                    }
                    parts.push(
                        <ruby key={match.index} className="mx-0.5">
                            {match[1]}
                            <rt className="text-[0.5em] text-gray-500 font-normal select-none">{match[2]}</rt>
                        </ruby>
                    );
                    lastIndex = regex.lastIndex;
                }
                if (lastIndex < text.length) {
                    parts.push(<span key={lastIndex}>{text.substring(lastIndex)}</span>);
                }
                return <span className={className}>{parts}</span>;
            };

            // Data
            const vocabularyList = [
                { id: 1, kanji: "飼[か]います", reading: "かいます", meaning: "養 (寵物)", example: "ペットを飼[か]っている (正在養寵物)", note: "補充：飼育[しいく]、飼料[しりょう]", imagePrompt: "cute person feeding a pet dog warm colors anime style", color: "bg-orange-100" },
                { id: 2, kanji: "走[はし]ります", reading: "はしります", meaning: "跑 / 行駛", example: "道[みち]を走[はし]る (在路上跑)", note: "補充：トップを走[はし]るランナー (跑在首位的跑者)", imagePrompt: "runner running fast on a track dynamic pose anime style", color: "bg-blue-100" },
                { id: 3, kanji: "見[み]えます", reading: "みえます", meaning: "看得見 (自然進入眼簾)", example: "富士山[ふじさん]が見[み]える (看得見富士山)", note: "區別：見[み]られます (主動能看) vs 見[み]えます (被動/自然)", imagePrompt: "view of mount fuji from a distance clear sky anime style", color: "bg-sky-100" },
                { id: 4, kanji: "聞[き]こえます", reading: "きこえます", meaning: "聽得見 (聲音自然傳入)", example: "鳥[とり]の声[こえ]が聞[き]こえる (聽見鳥叫聲)", note: "補充：微[かす]かに聞[き]こえる (隱約聽見)", imagePrompt: "person listening to birds singing in nature anime style", color: "bg-green-100" },
                { id: 5, kanji: "できます", reading: "できます", meaning: "完工 / 建成 / 產生", example: "駅前[えきまえ]に新[あたら]しい店[みせ]ができた (車站前開了新店)", note: "補充：木[き]でできている (用木頭做的)", imagePrompt: "new shop opening with flowers and decorations anime style", color: "bg-yellow-100" },
                { id: 6, kanji: "開[ひら]きます", reading: "ひらきます", meaning: "舉辦 / 開(班) / 張開", example: "料理教室[りょうりきょうしつ]を開[ひら]く (開料理教室)", note: "補充：花[はな]が開[ひら]く (花開)", imagePrompt: "cooking class with teacher and students anime style", color: "bg-rose-100" },
                { id: 7, kanji: "鳥[とり]", reading: "とり", meaning: "鳥", example: "空[そら]を飛[と]んでいる鳥[とり] (在空中飛的鳥)", note: "補充：焼[や]き鳥[とり] (烤雞肉串)", imagePrompt: "flock of birds flying in the blue sky anime style", color: "bg-cyan-100" },
                { id: 8, kanji: "声[こえ]", reading: "こえ", meaning: "聲音 (人或動物)", example: "大[おお]きな声[こえ] (大聲)", note: "補充：声[こえ]を掛[か]ける (打招呼)", imagePrompt: "person shouting or singing with sound waves visual anime style", color: "bg-purple-100" },
                { id: 9, kanji: "波[なみ]", reading: "なみ", meaning: "波浪", example: "波[なみ]の音[おと] (海浪聲)", note: "補充：人[ひと]の波[なみ] (人海/人潮)", imagePrompt: "ocean waves crashing on the beach anime style", color: "bg-blue-200" },
                { id: 10, kanji: "花火[はなび]", reading: "はなび", meaning: "煙火", example: "夏[なつ]の花火大会[はなびたいかい] (夏季煙火大會)", note: "補充：線香花火[せんこうはなび] (仙女棒)", imagePrompt: "colorful fireworks in the night sky anime style", color: "bg-indigo-100" },
                { id: 11, kanji: "道具[どうぐ]", reading: "どうぐ", meaning: "工具 / 道具", example: "大工[だいく]の道具[どうぐ] (木匠的工具)", note: "補充：釣[つ]りの道具[どうぐ] (釣具)", imagePrompt: "various carpentry tools hammer saw anime style", color: "bg-stone-200" },
                { id: 12, kanji: "教室[きょうしつ]", reading: "きょうしつ", meaning: "～教室 (才藝班)", example: "ピアノ教室[きょうしつ] (鋼琴教室)", note: "補充：学習塾[がくしゅうじゅく] (補習班)", imagePrompt: "piano classroom with grand piano anime style", color: "bg-pink-100" },
                { id: 13, kanji: "～しか", reading: "～しか", meaning: "只～ (後接否定)", example: "50円[えん]しか持[も]っていない (只有50元)", note: "重點：隱含「太少[すく]ない/不夠」的心情", imagePrompt: "hand holding a single small coin looking sad anime style", color: "bg-gray-200" },
                { id: 14, kanji: "他[ほか]の", reading: "ほかの", meaning: "其他的", example: "他[ほか]の店[みせ]に行[い]こう (去別家店吧)", note: "補充：他[ほか]にはない (別處沒有的)", imagePrompt: "person choosing between different shops anime style", color: "bg-teal-100" },
                { id: 15, kanji: "はっきり", reading: "はっきり", meaning: "清楚地 / 明確地", example: "はっきり見[み]える (看得一清二楚)", note: "補充：好[す]き嫌[きら]いがはっきりした人[ひと] (愛恨分明的人)", imagePrompt: "looking through glasses with clear vision anime style", color: "bg-emerald-100" },
                { id: 16, kanji: "不思議[ふしぎ]", reading: "ふしぎ", meaning: "不可思議 / 奇怪", example: "不思議[ふしぎ]な話[はなし] (不可思議的故事)", note: "補充：世界[せかい]の七不思議[ななふしぎ] (世界七大奇蹟)", imagePrompt: "magical glowing book floating mysterious anime style", color: "bg-violet-100" },
                { id: 17, kanji: "付[つ]けます", reading: "つけます", meaning: "戴上 / 縫上 / 塗抹", example: "ボタンを付[つ]ける (縫鈕扣)", note: "補充：名前[なまえ]をつける (取名字)", imagePrompt: "person sewing a button on a shirt closeup anime style", color: "bg-red-100" },
                { id: 18, kanji: "空[そら]", reading: "そら", meaning: "天空", example: "青[あお]い空[そら] (藍天)", note: "補充：青空駐車[あおぞらちゅうしゃ] (露天停車)", imagePrompt: "beautiful blue sky with fluffy white clouds anime style", color: "bg-sky-200" },
                { id: 19, kanji: "飛[と]びます", reading: "とびます", meaning: "飛", example: "飛行機[ひこうき]が飛[と]ぶ (飛機飛行)", note: "補充：話[はなし]が飛[と]ぶ (離題)", imagePrompt: "airplane flying high in the clouds anime style", color: "bg-blue-300" },
                { id: 20, kanji: "昔[むかし]", reading: "むかし", meaning: "從前 / 古時候", example: "昔[むかし]の遊[あそ]び (以前的遊戲)", note: "補充：昔話[むかしばなし] (民間故事)", imagePrompt: "historical japanese village sepia tone anime style", color: "bg-amber-100" }
            ];

            const currentWord = vocabularyList[currentIndex];

            const handleNext = () => {
                setIsFlipped(false);
                setLoading(true);
                setCurrentIndex((prev) => (prev + 1) % vocabularyList.length);
            };

            const handlePrev = () => {
                setIsFlipped(false);
                setLoading(true);
                setCurrentIndex((prev) => (prev - 1 + vocabularyList.length) % vocabularyList.length);
            };

            const handleFlip = () => {
                setIsFlipped(!isFlipped);
            };

            const speak = (text) => {
                const cleanText = text.replace(/\[.*?\]/g, "");
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'ja-JP';
                window.speechSynthesis.speak(utterance);
            };

            const getImageUrl = (prompt) => {
                return `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=600&height=400&nologo=true`;
            };

            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-gray-50 p-4 font-sans text-gray-800">
                    <div className="mb-8 text-center">
                        <h1 className="text-3xl font-bold text-gray-800 mb-2">大家的日本語 第27課</h1>
                        <p className="text-gray-500">互動式單字記憶卡</p>
                    </div>

                    <div className="relative w-full max-w-md h-[600px] perspective-1000">
                        <div className="absolute -top-6 left-0 w-full h-1 bg-gray-200 rounded-full overflow-hidden">
                            <div className="h-full bg-blue-500 transition-all duration-300" style={{ width: `${((currentIndex + 1) / vocabularyList.length) * 100}%` }}></div>
                        </div>
                        <div className="absolute -top-10 right-0 text-sm font-bold text-gray-400">
                            {currentIndex + 1} / {vocabularyList.length}
                        </div>

                        <div className={`relative w-full h-full transition-transform duration-500 transform-style-3d cursor-pointer ${isFlipped ? 'rotate-y-180' : ''}`} onClick={handleFlip}>
                            {/* Front */}
                            <div className={`absolute w-full h-full backface-hidden rounded-2xl shadow-xl overflow-hidden border border-gray-100 flex flex-col ${currentWord.color} bg-opacity-30 bg-white`}>
                                <div className="h-[45%] w-full bg-gray-200 relative overflow-hidden">
                                    <img src={getImageUrl(currentWord.imagePrompt)} alt={currentWord.kanji} className="w-full h-full object-cover" onLoad={() => setLoading(false)} />
                                    <div className="absolute top-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1">
                                        <Lightbulb size={12} /> 點擊翻轉查看意思
                                    </div>
                                </div>
                                <div className="flex-1 flex flex-col items-center justify-center p-6 bg-white">
                                    <p className="text-2xl text-gray-500 mb-2 font-medium">{currentWord.reading}</p>
                                    <div className="text-6xl text-gray-800 mb-6 font-black">
                                        <FuriganaText text={currentWord.kanji} />
                                    </div>
                                    <button onClick={(e) => { e.stopPropagation(); speak(currentWord.kanji); }} className="p-3 rounded-full bg-blue-50 text-blue-500 hover:bg-blue-100 transition-colors" title="播放發音">
                                        <Volume2 size={24} />
                                    </button>
                                </div>
                                <div className="p-4 bg-gray-50 text-center text-gray-400 text-sm"><p>點擊卡片查看中文翻譯與筆記</p></div>
                            </div>

                            {/* Back */}
                            <div className={`absolute w-full h-full backface-hidden rotate-y-180 rounded-2xl shadow-xl overflow-hidden border border-gray-100 flex flex-col bg-white`}>
                                <div className={`h-2 w-full ${currentWord.color.replace('bg-', 'bg-')}`}></div>
                                <div className="flex-1 p-8 flex flex-col items-center justify-center text-center">
                                    <h3 className="text-2xl text-gray-400 font-bold mb-4"><FuriganaText text={currentWord.kanji} /></h3>
                                    <div className="mb-8"><h2 className="text-4xl font-bold text-gray-800 mb-2">{currentWord.meaning}</h2></div>
                                    <div className="w-full bg-blue-50 p-4 rounded-xl mb-4 text-left">
                                        <div className="flex items-center gap-2 mb-2 text-blue-600 font-bold text-sm uppercase tracking-wide"><BookOpen size={16} /><span>例句</span></div>
                                        <p className="text-gray-700 font-medium text-lg leading-relaxed"><FuriganaText text={currentWord.example} /></p>
                                    </div>
                                    {currentWord.note && (
                                        <div className="w-full bg-orange-50 p-4 rounded-xl text-left border-l-4 border-orange-300">
                                            <p className="text-gray-600 text-sm leading-relaxed"><span className="font-bold text-orange-500 mr-2">筆記</span><FuriganaText text={currentWord.note} /></p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex items-center gap-8 mt-8">
                        <button onClick={handlePrev} className="p-4 rounded-full bg-white shadow-lg text-gray-600 hover:text-blue-500 hover:shadow-xl transition-all transform hover:-translate-y-1"><ChevronLeft size={28} /></button>
                        <button onClick={() => { setIsFlipped(false); setCurrentIndex(0); }} className="flex items-center gap-2 px-6 py-3 rounded-full bg-white shadow-md text-gray-600 font-medium hover:bg-gray-50 transition-colors"><RotateCcw size={18} /><span>重新開始</span></button>
                        <button onClick={handleNext} className="p-4 rounded-full bg-white shadow-lg text-gray-600 hover:text-blue-500 hover:shadow-xl transition-all transform hover:-translate-y-1"><ChevronRight size={28} /></button>
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<VocabularySlides />);
    </script>
</body>
</html>
