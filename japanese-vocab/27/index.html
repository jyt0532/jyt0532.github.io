<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大家的日本語 第27課 - 互動單字卡 (動漫增強穩定版)</title>
    
    <!-- 1. 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. 載入 Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. 設定 Import Map -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.294.0"
        }
    }
    </script>

    <style>
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        ruby { ruby-align: center; }
        rt { line-height: 1; user-select: none; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* 圖片載入動畫 */
        @keyframes pulse-gray {
            0%, 100% { background-color: #e2e8f0; }
            50% { background-color: #cbd5e1; }
        }
        .animate-pulse-gray {
            animation: pulse-gray 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-slate-100">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useCallback } from 'react';
        import { createRoot } from 'react-dom/client';
        import { ChevronLeft, ChevronRight, RotateCcw, Volume2, BookOpen, Lightbulb, Image as ImageIcon, RefreshCw } from 'lucide-react';

        // ---------------------------------------------------------
        // 1. 智慧圖片元件
        // ---------------------------------------------------------
        const SmartImage = ({ src, alt, className }) => {
            const [status, setStatus] = useState('loading'); // loading, loaded, error
            const [retryCount, setRetryCount] = useState(0);
            const maxRetries = 3;

            useEffect(() => {
                setStatus('loading');
                setRetryCount(0);
                
                // 嘗試預載圖片以確認其可用性
                const img = new Image();
                img.src = src;
                img.onload = () => setStatus('loaded');
                img.onerror = () => {
                    // 第一次失敗不立即報錯，等待重試機制
                    if (retryCount === 0) handleError();
                };
            }, [src]);

            const handleError = () => {
                if (retryCount < maxRetries) {
                    setTimeout(() => {
                        setRetryCount(prev => prev + 1);
                    }, 2000); // 延長重試間隔至 2 秒
                } else {
                    setStatus('error');
                }
            };

            // 加入時間戳以繞過可能的緩存問題（僅在重試時）
            const currentSrc = retryCount > 0 ? `${src}&t=${Date.now()}` : src;

            return (
                <div className={`relative w-full h-full overflow-hidden ${className}`}>
                    {/* 載入中 */}
                    {status !== 'loaded' && status !== 'error' && (
                        <div className="absolute inset-0 flex flex-col items-center justify-center bg-gray-100 animate-pulse-gray z-10">
                            <ImageIcon className="text-gray-400 w-10 h-10 mb-2 opacity-50" />
                            <span className="text-gray-400 text-xs">
                                {retryCount > 0 ? `重試中 (${retryCount}/${maxRetries})...` : '繪製中...'}
                            </span>
                        </div>
                    )}

                    {/* 錯誤 */}
                    {status === 'error' && (
                        <div className="absolute inset-0 flex flex-col items-center justify-center bg-gray-100 z-10">
                            <p className="text-gray-400 text-xs mb-2">圖片載入失敗</p>
                            <button 
                                onClick={(e) => {
                                    e.stopPropagation();
                                    setRetryCount(0);
                                    setStatus('loading');
                                }}
                                className="flex items-center gap-1 px-3 py-1 bg-white border border-gray-300 rounded-full text-xs text-gray-600 hover:bg-gray-50 shadow-sm"
                            >
                                <RefreshCw size={12} /> 重試
                            </button>
                        </div>
                    )}

                    {/* 圖片 */}
                    <img 
                        src={currentSrc} 
                        alt={alt}
                        className={`w-full h-full object-cover transition-opacity duration-500 ${status === 'loaded' ? 'opacity-100' : 'opacity-0'}`}
                        onLoad={() => setStatus('loaded')}
                        onError={handleError}
                    />
                </div>
            );
        };

        const VocabularySlides = () => {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);

            const speak = (text) => {
                // 移除 [ ] 內的讀音標記
                let cleanText = text.replace(/\[.*?\]/g, "");
                // 移除括號內的中文翻譯 (例如：(正在養寵物))
                cleanText = cleanText.replace(/\(.*?\)/g, "");
                // 移除全形括號內的中文翻譯 (例如：(正在養寵物))
                cleanText = cleanText.replace(/（.*?）/g, "");
                
                const utterance = new SpeechSynthesisUtterance(cleanText);
                utterance.lang = 'ja-JP';
                window.speechSynthesis.speak(utterance);
            };

            // Furigana Component with Speaker Button for each line
            const FuriganaText = ({ text, className = "", showSpeaker = false, speakerColor = "text-gray-400" }) => {
                if (!text) return null;
                const lines = text.split('\n');
                
                return (
                    <>
                        {lines.map((line, lineIndex) => {
                            // 提取純日文部分供朗讀 (移除括號翻譯)
                            const japanesePart = line.split('(')[0].split('（')[0]; 

                            const regex = /([\u4e00-\u9faf々]+)\[(.*?)\]/g;
                            const parts = [];
                            let lastIndex = 0;
                            let match;

                            while ((match = regex.exec(line)) !== null) {
                                if (match.index > lastIndex) {
                                    parts.push(<span key={`${lineIndex}-${lastIndex}`}>{line.substring(lastIndex, match.index)}</span>);
                                }
                                parts.push(
                                    <ruby key={`${lineIndex}-${match.index}`} className="mx-0.5">
                                        {match[1]}
                                        <rt className="text-[0.55em] text-gray-600 font-normal select-none">{match[2]}</rt>
                                    </ruby>
                                );
                                lastIndex = regex.lastIndex;
                            }
                            if (lastIndex < line.length) {
                                parts.push(<span key={`${lineIndex}-${lastIndex}`}>{line.substring(lastIndex)}</span>);
                            }

                            return (
                                <div key={lineIndex} className={`flex items-start gap-2 ${lineIndex > 0 ? 'mt-3 pt-2 border-t border-dashed border-gray-200' : ''} ${className}`}>
                                    {showSpeaker && (
                                        <button 
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                speak(japanesePart);
                                            }}
                                            className={`mt-1 flex-shrink-0 p-1 rounded-full hover:bg-gray-100 transition-colors ${speakerColor}`}
                                            title="朗讀此句"
                                        >
                                            <Volume2 size={16} />
                                        </button>
                                    )}
                                    <span className="block flex-1">
                                        {parts}
                                    </span>
                                </div>
                            );
                        })}
                    </>
                );
            };

            // Data
            const vocabularyList = [
                { 
                    id: 1, 
                    kanji: "飼[か]います", 
                    reading: "かいます", 
                    meaning: "養 (寵物)", 
                    example: "ペットを飼[か]っている (正在養寵物)\n放[はな]し飼[が]い (放養)\n飼育[しいく] (飼養)\n飼料[しりょう] (飼料)", 
                    imagePrompt: "anime style, cute girl feeding a small puppy in a warm sunny garden, studio ghibli art style, detailed, soft lighting", 
                    color: "bg-orange-50",
                    accentColor: "text-orange-600",
                    borderColor: "border-orange-200"
                },
                { 
                    id: 2, 
                    kanji: "走[はし]ります", 
                    reading: "はしります", 
                    meaning: "跑 / 行駛", 
                    example: "道[みち]を走[はし]る (在路上跑)\nトップを走[はし]る (跑第一)\n敵陣[てきじん]に走[はし]る (投奔敵營)\n背中[せなか]に痛[いた]みが走[はし]る (背部一陣劇痛竄過)\n極端[きょくたん]に走[はし]る (走極端)\n奔走[ほんそう] (奔走/四處忙碌)\n走塁[そうるい] (跑壘)\n走者一掃[そうしゃいっそう] (清壘)", 
                    imagePrompt: "anime style, energetic boy running fast on a track, dynamic action pose, speed lines, sports anime aesthetic, determination", 
                    color: "bg-blue-50",
                    accentColor: "text-blue-600",
                    borderColor: "border-blue-200"
                },
                { 
                    id: 3, 
                    kanji: "見[み]えます", 
                    reading: "みえます", 
                    meaning: "看得見 (自然進入眼簾)", 
                    example: "富士山[ふじさん]が見[み]える (看得見富士山)\n目[め]に見[み]えて良[よ]くなった (肉眼可見地變好)\n解決[かいけつ]したかに見[み]える (看起來似乎解決了)\n先生[せんせい]が見[み]えたよ (老師來了-敬語)", 
                    imagePrompt: "anime style, beautiful view of Mount Fuji from a distance, blue sky, cherry blossoms, makoto shinkai art style, scenic", 
                    color: "bg-sky-50",
                    accentColor: "text-sky-600",
                    borderColor: "border-sky-200"
                },
                { 
                    id: 4, 
                    kanji: "聞[き]こえます", 
                    reading: "きこえます", 
                    meaning: "聽得見 (聲音自然傳入)", 
                    example: "微[かす]かに聞[き]こえる (隱約聽見)\n人[ひと]の声[こえ]が聞[き]こえる (聽見人的聲音)\n彼[かれ]の発言[はつげん]は皮肉[ひにく]に聞[き]こえる (聽起來很諷刺)", 
                    imagePrompt: "anime style, girl listening to birds singing in a forest, hand cupping ear, peaceful nature, kyoto animation style, soft green", 
                    color: "bg-green-50",
                    accentColor: "text-green-600",
                    borderColor: "border-green-200"
                },
                { 
                    id: 5, 
                    kanji: "できます", 
                    reading: "できます", 
                    meaning: "完工 / 建成 / 產生", 
                    example: "駅前[えきまえ]に新[あたら]しい店[みせ]ができた (車站前開了新店)\n免疫[めんえき]ができる (產生免疫力)\n耳[みみ]にたこができる (耳朵長繭了/聽膩了)\n木[き]でできている (用木頭做成的)\n出来物[できもの] (腫包)", 
                    imagePrompt: "anime style, grand opening of a cute bakery shop, flowers, balloons, happy atmosphere, slice of life anime", 
                    color: "bg-yellow-50",
                    accentColor: "text-yellow-600",
                    borderColor: "border-yellow-200"
                },
                { 
                    id: 6, 
                    kanji: "開[ひら]きます", 
                    reading: "ひらきます", 
                    meaning: "舉辦 / 開(班) / 張開", 
                    example: "料理教室[りょうりきょうしつ]を開[ひら]く (開料理教室)\n花[はな]が開[ひら]く (花開了)\n銀行[ぎんこう]が開[ひら]く (銀行開門營業)\n本[ほん]を開[ひら]く (打開書)\n心[こころ]を開[ひら]く (敞開心房)\n店[みせ]を開[ひら]く (開店)\n両開[りょうびら]き (雙開)\n店開[みせびら]き (開店/開張)\n海開[うみびら]き (海水浴場開放)", 
                    imagePrompt: "anime style, flowers blooming magically, sparkles, open book, warm light, shoujo anime art style", 
                    color: "bg-rose-50",
                    accentColor: "text-rose-600",
                    borderColor: "border-rose-200"
                },
                { 
                    id: 7, 
                    kanji: "鳥[とり]", 
                    reading: "とり", 
                    meaning: "鳥", 
                    example: "空[そら]を飛[と]んでいる鳥[とり] (在空中飛的鳥)\n焼[や]き鳥[とり] (烤雞串)\n鶏[にわとり]＝庭鳥[にわとり] (雞)\n養鶏場[ようけいじょう] (養雞場)\n鳥[とり]インフルエンザ (禽流感)", 
                    imagePrompt: "anime style, white birds flying in a vast blue sky, freedom, studio ghibli clouds, high detail", 
                    color: "bg-cyan-50",
                    accentColor: "text-cyan-600",
                    borderColor: "border-cyan-200"
                },
                { 
                    id: 8, 
                    kanji: "声[こえ]", 
                    reading: "こえ", 
                    meaning: "聲音 (人或動物)", 
                    example: "大[おお]きな声[こえ] (大聲)\n声[こえ]を掛[か]ける (打招呼)\n声[こえ]が掠[かす]れる (沙啞)\n不満[ふまん]の声[こえ]が上[あ]がる (不滿聲四起)\n裏声[うらごえ] (假音)\n地声[じごえ] (真音)", 
                    imagePrompt: "anime style, girl singing loudly on stage, musical notes floating, shiny microphone, idol anime style, vibrant", 
                    color: "bg-purple-50",
                    accentColor: "text-purple-600",
                    borderColor: "border-purple-200"
                },
                { 
                    id: 9, 
                    kanji: "波[なみ]", 
                    reading: "なみ", 
                    meaning: "波浪", 
                    example: "波[なみ]の音[おと] (海浪聲)\n人[ひと]の波[なみ] (人海)\n景気回復[けいきかいふく]の波[なみ]に乗[の]る (順應景氣復甦)\n甍[いらか]の波[なみ] (屋瓦波浪)\n波浪注意報[はろうちゅういほう] (波浪警報)\n波紋[はもん]が生[しょう]じ (產生波紋/風波)", 
                    imagePrompt: "anime style, ocean waves crashing on a beach at sunset, sparkling water, emotional scenery, detailed water", 
                    color: "bg-indigo-50",
                    accentColor: "text-indigo-600",
                    borderColor: "border-indigo-200"
                },
                { 
                    id: 10, 
                    kanji: "花火[はなび]", 
                    reading: "はなび", 
                    meaning: "煙火", 
                    example: "夏[なつ]の花火大会[はなびたいかい] (夏季煙火大會)\n線香花火[せんこうはなび] (仙女棒)\n打[う]ち上[あ]げ花火[はなび] (高空煙火)", 
                    imagePrompt: "anime style, beautiful fireworks in night sky, characters in yukata watching, summer festival, colorful illumination", 
                    color: "bg-red-50",
                    accentColor: "text-red-600",
                    borderColor: "border-red-200"
                },
                { 
                    id: 11, 
                    kanji: "道具[どうぐ]", 
                    reading: "どうぐ", 
                    meaning: "工具 / 道具", 
                    example: "大工[だいく]の道具[どうぐ] (木匠的工具)\n釣[つ]りの道具[どうぐ] (釣具)\n知識[ちしき]を出世[しゅっせ]の道具[どうぐ]にする (把知識當作升遷工具)", 
                    imagePrompt: "anime style, various tools on a wooden workbench, hammer, wrench, detailed objects, warm workshop lighting", 
                    color: "bg-stone-50",
                    accentColor: "text-stone-600",
                    borderColor: "border-stone-200"
                },
                { 
                    id: 12, 
                    kanji: "教室[きょうしつ]", 
                    reading: "きょうしつ", 
                    meaning: "～教室 (才藝班)", 
                    example: "ピアノ教室[きょうしつ] (鋼琴教室)\n体操教室[たいそうきょうしつ] (體操教室)\n学習塾[がくしゅうじゅく] (補習班)\n英会話[えいかいわ]スクール (英語補習班)", 
                    imagePrompt: "anime style, japanese classroom with desks and chalkboard, sunlight coming through window, nostalgic school life", 
                    color: "bg-pink-50",
                    accentColor: "text-pink-600",
                    borderColor: "border-pink-200"
                },
                { 
                    id: 13, 
                    kanji: "～しか", 
                    reading: "～しか", 
                    meaning: "只～ (後接否定)", 
                    example: "50円[えん]しか持[も]っていない (只有50元-太少了)\nやるなら今[いま]しかない (要使用的話現在是唯一機會)\nあなたにしか教[おし]えない (只告訴你)", 
                    imagePrompt: "anime style, character looking at a single coin in hand, sad expression, empty wallet, dramatic lighting", 
                    color: "bg-gray-50",
                    accentColor: "text-gray-600",
                    borderColor: "border-gray-200"
                },
                { 
                    id: 14, 
                    kanji: "他[ほか]の", 
                    reading: "ほかの", 
                    meaning: "其他的", 
                    example: "他[ほか]の店[みせ]に行[い]こう (去別家店吧)\n他[ほか]にはない品揃[しなぞろ]え (別處沒有的商品陣容)\n他[ほか]に漏[も]らすな (別洩漏給別人)\n思[おも]いの外[ほか]の重傷[じゅうしょう]だ (出乎意料的重傷)", 
                    imagePrompt: "anime style, character standing at crossroads looking at different paths, adventure, decision making, fantasy landscape", 
                    color: "bg-teal-50",
                    accentColor: "text-teal-600",
                    borderColor: "border-teal-200"
                },
                { 
                    id: 15, 
                    kanji: "はっきり", 
                    reading: "はっきり", 
                    meaning: "清楚地 / 明確地", 
                    example: "はっきり見[み]える (看得一清二楚)\n好[す]き嫌[きら]いがはっきりした人[ひと] (愛恨分明的人)\n二日酔[ふつかよ]いで頭[あたま]がはっきりしない (因為宿醉頭腦不清)", 
                    imagePrompt: "anime style, putting on glasses, world becoming clear and sharp, focus effect, bright eyes", 
                    color: "bg-emerald-50",
                    accentColor: "text-emerald-600",
                    borderColor: "border-emerald-200"
                },
                { 
                    id: 16, 
                    kanji: "不思議[ふしぎ]", 
                    reading: "ふしぎ", 
                    meaning: "不可思議 / 奇怪", 
                    example: "不思議[ふしぎ]な話[はなし] (不可思議的故事)\n世界[せかい]の七不思議[ななふしぎ] (世界七大奇蹟)\n事故[じこ]が起[お]こっても不思議[ふしぎ]ではない (發生事故也不奇怪)\n摩訶不思議[まかふしぎ] (非常不可思議)", 
                    imagePrompt: "anime style, magical floating book, glowing mysterious runes, fantasy library, purple magic aura", 
                    color: "bg-violet-50",
                    accentColor: "text-violet-600",
                    borderColor: "border-violet-200"
                },
                { 
                    id: 17, 
                    kanji: "付[つ]けます", 
                    reading: "つけます", 
                    meaning: "戴上 / 縫上 / 塗抹", 
                    example: "ボタンを付[つ]ける (縫鈕扣)\n服[ふく]にボタンをつける (把鈕扣縫在衣服上)\n仮面[かめん]をつけて演[えん]じる (戴著面具演戲)\n改革[かいかく]に手[て]をつける (著手進行改革)\n名前[なまえ]をつける (取名字)", 
                    imagePrompt: "anime style, close up of hands sewing a button, needle and thread, cozy detailed art, slice of life", 
                    color: "bg-red-50",
                    accentColor: "text-red-600",
                    borderColor: "border-red-200"
                },
                { 
                    id: 18, 
                    kanji: "空[そら]", 
                    reading: "そら", 
                    meaning: "天空", 
                    example: "青[あお]い空[そら] (藍天)\n青空[あおぞら] (藍天)\n青空駐車[あおぞらちゅうしゃ] (露天停車)", 
                    imagePrompt: "anime style, vast blue sky with huge white clouds, summer vibe, makoto shinkai style clouds, bright", 
                    color: "bg-sky-100",
                    accentColor: "text-sky-700",
                    borderColor: "border-sky-300"
                },
                { 
                    id: 19, 
                    kanji: "飛[と]びます", 
                    reading: "とびます", 
                    meaning: "飛", 
                    example: "飛行機[ひこうき]が飛[と]ぶ (飛機飛行)\n午後[ごご]の便[びん]で日本[にほん]に飛[と]ぶ (搭下午的班機飛往日本)\n台風[たいふう]で瓦[かわら]が飛[と]んだ (因為颱風，瓦片飛走了)\n川[かわ]を飛[と]んで渡[わた]る (飛躍渡河)\n話[はなし]が飛[と]ぶ (離題)", 
                    imagePrompt: "anime style, airplane flying high above clouds, sunlight, travel, sense of freedom, blue sky", 
                    color: "bg-blue-100",
                    accentColor: "text-blue-700",
                    borderColor: "border-blue-300"
                },
                { 
                    id: 20, 
                    kanji: "昔[むかし]", 
                    reading: "むかし", 
                    meaning: "從前 / 古時候", 
                    example: "昔[むかし]の遊[あそ]び (以前的遊戲)\n昔話[むかしばなし] (民間故事)\n城下町[じょうかまち]と言[い]っても、昔[むかし]の面影[おもかげ]はない (雖說是城下町，但已無往日風貌)", 
                    imagePrompt: "anime style, old japanese village, sepia tone, nostalgia, traditional houses, sunset, historical atmosphere", 
                    color: "bg-amber-50",
                    accentColor: "text-amber-600",
                    borderColor: "border-amber-200"
                }
            ];

            const currentWord = vocabularyList[currentIndex];

            // ---------------------------------------------------------
            // 3. 全圖片預載 (Global Preloader)
            // ---------------------------------------------------------
            const getImageUrl = (prompt, id) => {
                const encodedPrompt = encodeURIComponent(prompt);
                return `https://image.pollinations.ai/prompt/${encodedPrompt}?width=600&height=400&nologo=true&seed=${id}&model=flux`;
            };

            // 在背景將所有圖片載入到瀏覽器快取中
            useEffect(() => {
                const preloadAllImages = async () => {
                    console.log("開始背景預載所有圖片...");
                    for (const item of vocabularyList) {
                        const img = new Image();
                        img.src = getImageUrl(item.imagePrompt, item.id);
                        // 我們不等待它載完，直接發出請求，瀏覽器會處理快取
                    }
                };
                // 延遲一點執行，讓首屏優先渲染
                const timer = setTimeout(preloadAllImages, 1000);
                return () => clearTimeout(timer);
            }, []);

            const handleNext = useCallback(() => {
                setIsFlipped(false);
                setCurrentIndex((prev) => (prev + 1) % vocabularyList.length);
            }, [vocabularyList.length]);

            const handlePrev = useCallback(() => {
                setIsFlipped(false);
                setCurrentIndex((prev) => (prev - 1 + vocabularyList.length) % vocabularyList.length);
            }, [vocabularyList.length]);

            const handleFlip = () => {
                setIsFlipped(!isFlipped);
            };

            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-slate-100 p-4 font-sans text-gray-800">
                    
                    <div className="mb-6 text-center">
                        <h1 className="text-3xl font-bold text-gray-800 mb-1">大家的日本語 第27課</h1>
                        <p className="text-gray-500 text-sm">互動式單字記憶卡</p>
                    </div>

                    <div className="relative w-full max-w-md h-[640px] perspective-1000">
                        
                        {/* Progress Bar */}
                        <div className="absolute -top-6 left-0 w-full h-1 bg-gray-200 rounded-full overflow-hidden">
                            <div 
                                className="h-full bg-blue-500 transition-all duration-300"
                                style={{ width: `${((currentIndex + 1) / vocabularyList.length) * 100}%` }}
                            />
                        </div>
                        <div className="absolute -top-8 right-0 text-xs font-bold text-gray-400">
                            {currentIndex + 1} / {vocabularyList.length}
                        </div>

                        {/* The Flip Card */}
                        <div 
                            className={`relative w-full h-full transition-transform duration-500 transform-style-3d cursor-pointer ${isFlipped ? 'rotate-y-180' : ''}`}
                            onClick={handleFlip}
                        >
                            
                            {/* Front Side */}
                            <div className={`absolute w-full h-full backface-hidden rounded-2xl shadow-xl overflow-hidden border ${currentWord.borderColor} flex flex-col ${currentWord.color} bg-white`}>
                                
                                {/* Image Area with Smart Loading */}
                                <div className="h-[40%] w-full bg-gray-200 relative overflow-hidden group">
                                    <SmartImage 
                                        src={getImageUrl(currentWord.imagePrompt, currentWord.id)}
                                        alt={currentWord.kanji}
                                        className="w-full h-full"
                                    />
                                    
                                    <div className="absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1 backdrop-blur-sm opacity-0 group-hover:opacity-100 transition-opacity z-20">
                                        <Lightbulb size={12} /> 點擊翻轉
                                    </div>
                                </div>

                                {/* Content Area */}
                                <div className="flex-1 flex flex-col items-center justify-center p-6 bg-white relative">
                                    <div className={`absolute top-0 left-0 w-full h-1 ${currentWord.color.replace('bg-', 'bg-opacity-50 bg-')}`}></div>
                                    
                                    <p className="text-xl text-gray-400 mb-3 font-medium tracking-wide">{currentWord.reading}</p>
                                    
                                    <div className={`text-5xl font-black mb-8 text-center ${currentWord.accentColor}`}>
                                        {/* 單字正面，不顯示發音按鈕，點擊大喇叭發音 */}
                                        <FuriganaText text={currentWord.kanji} />
                                    </div>
                                    
                                    <button 
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            speak(currentWord.kanji);
                                        }}
                                        className={`p-4 rounded-full ${currentWord.color} ${currentWord.accentColor} hover:brightness-95 transition-all active:scale-95 shadow-sm`}
                                        title="播放發音"
                                    >
                                        <Volume2 size={28} />
                                    </button>
                                </div>
                                
                                <div className="p-3 bg-gray-50 text-center text-gray-400 text-xs border-t border-gray-100">
                                    點擊卡片查看意思與例句
                                </div>
                            </div>

                            {/* Back Side */}
                            <div className="absolute w-full h-full backface-hidden rotate-y-180 rounded-2xl shadow-xl overflow-hidden border border-gray-200 flex flex-col bg-white">
                                <div className={`h-2 w-full ${currentWord.color.replace('bg-', 'bg-')}`}></div> 
                                
                                <div className="flex-1 flex flex-col p-6 h-full">
                                    <div className="text-center mb-4 pb-4 border-b border-gray-100">
                                        <h3 className={`text-2xl font-bold mb-1 ${currentWord.accentColor} flex items-center justify-center gap-2`}>
                                            <FuriganaText text={currentWord.kanji} />
                                            <button 
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    speak(currentWord.kanji);
                                                }}
                                                className={`p-1.5 rounded-full bg-gray-100 text-gray-500 hover:bg-gray-200 hover:text-gray-700 transition-colors`}
                                                title="播放單字發音"
                                            >
                                                <Volume2 size={18} />
                                            </button>
                                        </h3>
                                        <p className="text-lg text-gray-800 font-bold mt-2">{currentWord.meaning}</p>
                                    </div>

                                    <div className="flex-1 overflow-y-auto no-scrollbar pr-1">
                                        <div className="bg-gray-50 rounded-xl p-4 border border-gray-100">
                                            <div className="flex items-center gap-2 mb-3 text-gray-500 font-bold text-xs uppercase tracking-wider sticky top-0 bg-gray-50 py-1">
                                                <BookOpen size={14} />
                                                <span>例句與補充</span>
                                            </div>
                                            <div className="text-gray-700 text-base leading-relaxed space-y-3">
                                                {/* 例句區域，啟用 showSpeaker 功能 */}
                                                <FuriganaText 
                                                    text={currentWord.example} 
                                                    showSpeaker={true} 
                                                    speakerColor={currentWord.accentColor} 
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    {/* Controls */}
                    <div className="flex items-center gap-6 mt-8">
                        <button 
                            onClick={handlePrev}
                            className="p-4 rounded-full bg-white shadow-md text-gray-600 hover:text-blue-600 hover:shadow-lg transition-all active:scale-95 border border-gray-100"
                            aria-label="上一個"
                        >
                            <ChevronLeft size={24} />
                        </button>

                        <button 
                            onClick={() => {
                                setIsFlipped(false);
                                setCurrentIndex(0);
                            }}
                            className="flex items-center gap-2 px-6 py-3 rounded-full bg-white shadow-md text-gray-600 font-medium hover:text-blue-600 hover:shadow-lg transition-all active:scale-95 border border-gray-100"
                        >
                            <RotateCcw size={18} />
                            <span className="text-sm">重新開始</span>
                        </button>

                        <button 
                            onClick={handleNext}
                            className="p-4 rounded-full bg-white shadow-md text-gray-600 hover:text-blue-600 hover:shadow-lg transition-all active:scale-95 border border-gray-100"
                            aria-label="下一個"
                        >
                            <ChevronRight size={24} />
                        </button>
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<VocabularySlides />);
    </script>
</body>
</html>
